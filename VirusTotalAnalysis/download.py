"""

"""
from pathlib import Path
import sys

import requests
from tqdm import tqdm

from cfg import KEY


PATH = Path("macho")
PATH.mkdir(exist_ok=True)
with open("macho.txt") as fp:
    shas = [f.strip() for f in fp.readlines()]


for s in tqdm(shas):
   url = f"https://www.virustotal.com/api/v3/files/{s}/download"
   headers = {"accept": "application/json", 'x-apikey': KEY}
   response = requests.get(url, headers=headers)
   if response.status_code != 200:
       print(response.status_code, response.text)
       continue
   with open(PATH / s, "wb") as fp:
       fp.write(response.content)
   sys.exit(0)

